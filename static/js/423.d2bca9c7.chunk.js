"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[423,728],{5463:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var a=n(5671),s=n(3144),i=n(136),r=n(2963),c=n(1120),o=n(9526),l=n(1498),d=n(2246),u=n(9934),m=n(536),f=n(885);const g=function(e){var t="textyng";e.name&&(t=e.name);var n=o.useState(t),a=(0,f.default)(n,2),s=a[0],i=a[1],r=o.useState(!1),c=(0,f.default)(r,2),d=c[0],u=c[1];return o.createElement("div",{className:"EditableField"},d?o.createElement(l.default,{autoFocus:!0,inputProps:{maxLength:20,style:{fontSize:e.fontSize?e.fontSize:50}},value:s,onChange:function(e){return i(e.target.value)},onBlur:function(t){return u(!1),void e.getScriptName([e.id,s])}}):o.createElement("div",{onClick:function(){u(!0)}},s))};var p=n(2982);const h=function(e){var t=[{name:"Kiyo",id:1},{name:"Cast Member",id:2}],n=o.useState(e.cast&&e.cast.length>0?e.cast:t),a=(0,f.default)(n,2),s=a[0],i=a[1],r=o.useState(e.cast&&e.cast.length>0?e.cast.length:t.length),c=(0,f.default)(r,2),l=c[0],d=c[1];function u(t){for(var n=t[0],a=t[1],r=0;r<s.length;r++)s[r].id==n&&(s[r].name=a);i((function(e){return(0,p.default)(e)})),e.getAllCast(s)}return o.createElement("div",{className:"CastMembers"},s.map((function(t,n){return o.createElement("div",{id:"CastMembers-castId-"+t.id,className:"CastMembers-cast",key:n,onClick:function(){return function(t){for(var n=document.querySelectorAll(".CastMembers-cast"),a=0;a<n.length;a++)n[a].classList.remove("active");document.getElementById("CastMembers-castId-"+t.id).classList.add("active"),!e.selectedCast||e.selectedCast(t)}(t)}},o.createElement(g,{name:t.name,id:t.id,fontSize:16,getScriptName:u}))})),o.createElement("div",{className:"CastMembers-addCast CastMembers-cast",onClick:function(){return function(){var t={name:"Cast Member",id:l+1};i((function(e){return[].concat((0,p.default)(e),[t])})),d(l+1),e.getAllCast(s)}()}},"+"))};const v=function(e){var t=[{name:"Bombay",id:1},{name:"Sheraton Hostel",id:2}],n=o.useState(e.scenes&&e.scenes.length>0?e.scenes:t),a=(0,f.default)(n,2),s=a[0],i=a[1],r=o.useState(e.scenes&&e.scenes.length>0?e.scenes.length:t.length),c=(0,f.default)(r,2),l=c[0],d=c[1];function u(t){for(var n=t[0],a=t[1],r=0;r<s.length;r++)s[r].id==n&&(s[r].name=a);i((function(e){return(0,p.default)(e)})),e.getAllScenes(s)}return o.createElement("div",{className:"Scenes"},s.map((function(t,n){return o.createElement("div",{id:"Scenes-sceneId-"+t.id,className:"Scenes-scene",key:n,onClick:function(){return function(t){for(var n=document.querySelectorAll(".Scenes-scene"),a=0;a<n.length;a++)n[a].classList.remove("active");document.getElementById("Scenes-sceneId-"+t.id).classList.add("active"),!e.selectedScene||e.selectedScene(t)}(t)}},o.createElement(g,{name:t.name,id:t.id,fontSize:16,getScriptName:u}))})),o.createElement("div",{className:"Scenes-addScene Scenes-scene",onClick:function(){return function(){var t={name:"Scene",id:l+1};i((function(e){return[].concat((0,p.default)(e),[t])})),d(l+1),e.getAllScenes(s)}()}},"+"))};var S=n(7586);const y=function(e){var t=(0,o.useRef)(null);return o.createElement("div",{className:"FilePicker"},o.createElement("span",null,e.msgType),o.createElement("input",{className:"file-input",type:"file",ref:t,onChange:function(t){var n=t.target.files[0],a=S.default.storage().ref(e.msgType.replace(/ /g,"")+"/").child(n.name);a.put(n).then((function(){a.getDownloadURL().then((function(t){e.getImgURL(t)}))}))}}))};var M=n(377);n(7764);const N=function(e){var t=o.useState(!1),n=(0,f.default)(t,2),a=n[0],s=n[1],i=o.useState(null),r=(0,f.default)(i,2),c=r[0],l=r[1];return o.createElement("div",{className:"RecordModal"},a?o.createElement("div",{className:"RecordModal-modalPopup"},o.createElement(M.Recorder,{handleAudioStop:function(t){s(!1),l(t.blobURL);var n=Math.floor(Date.now()/1e3),a=S.default.storage().ref("VoiceNotes/"+n),i=new File([t.blob],n.toString()+"audio.mp3",{type:"audio/mp3",metadata:{cors:[{origin:["http://localhost:19006"]}]}});a.put(i).then((function(t){t.ref.getDownloadURL().then((function(t){e.getVNURL(t)}))}))}})):o.createElement("button",{onClick:function(){s(!0)},className:"RecordModal-recordBbutton"},"Start recording"),c&&o.createElement("div",null,o.createElement("audio",{src:c,controls:!0})))};const E=function(e){return o.createElement("div",{className:"MsgTypes"},o.createElement("div",{className:"MsgTypes-name",onClick:function(){return e.grabScreenshot()}},"Screen Shot"),o.createElement("div",{className:"MsgTypes-name"},o.createElement(y,{msgType:"Upload Image",getImgURL:e.getInsertedImg})),o.createElement("div",{className:"MsgTypes-name"},o.createElement(N,{msgType:"Voice Note",getVNURL:e.getVNURL})),o.createElement("div",{className:"MsgTypes-name"},o.createElement(y,{msgType:"Upload Video",getImgURL:e.getUplodedVideo})),["Thinking...","Left Scene"].map((function(t,n){return o.createElement("div",{id:"MsgTypes-id-"+n,className:"MsgTypes-name",key:n,onClick:function(){return e.selectedMsgType?e.selectedMsgType(t):{}}},t)})))};var w=n(9826);const C=function(e){var t=o.useState("0:00"),n=(0,f.default)(t,2),a=n[0],s=n[1],i=function(e){var t=e.split(":"),n=(0,f.default)(t,3),a=n[0],s=n[1],i=n[2],r=Number(a),c=Number(s),o=Number(i);return!isNaN(r)&&isNaN(c)&&isNaN(o)?r:isNaN(r)||isNaN(c)||!isNaN(o)?isNaN(r)||isNaN(c)||isNaN(o)?0:60*r*60+60*c+o:60*r+c},r=function(e){var t=parseInt(e.toString(),10);return[Math.floor(t/3600),Math.floor(t/60)%60,t%60].map((function(e){return e<10?"0"+e:e})).filter((function(e,t){return"00"!==e||t>0})).join(":").replace(/^0/,"")};return e.spslm&&s(e.spslm),o.createElement("input",{className:"TimeInput",type:"text",onChange:function(e){s(e.target.value)},onBlur:function(t){var n=t.target.value,a=Math.max(0,i(n));e.inputTime(a);var c=r(a);s(c)},value:a})};const k=function(e){var t=(0,o.useState)(!1),n=(0,f.default)(t,2),a=n[0],s=n[1],i=(0,o.useState)(e.alreadySavedValue),r=(0,f.default)(i,2),c=r[0],d=r[1];return o.createElement("div",{className:"parent-element"},a&&o.createElement("div",{id:"popup"},o.createElement("div",{id:"popup-content"},o.createElement(l.default,{variant:"outlined",value:c,placeholder:"Type comment here",onChange:function(e){d(e.target.value)},multiline:!0,minRows:4}),o.createElement("button",{id:"save",onClick:function(){e.onSave(c,e.idOfMsgCommented,e.whoSentCommentedMsg),s(!1)}},"Save"),o.createElement("button",{id:"close",onClick:function(){s(!1)}},"\xd7"))),o.createElement("button",{id:"commented-button",onClick:function(){s(!0)}},"comment"))};var I=n(900),b=n.n(I);function A(e,t){var n="undefined"!==typeof Symbol&&e["function"===typeof Symbol?Symbol.iterator:"@@iterator"]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,c.default)(e);if(t){var s=(0,c.default)(this).constructor;n=Reflect.construct(a,arguments,s)}else n=a.apply(this,arguments);return(0,r.default)(this,n)}}var x=function(e){(0,i.default)(n,e);var t=L(n);function n(e){var s;return(0,a.default)(this,n),(s=t.call(this,e)).getScriptName=function(e){s.state.script.updateScriptName(e[1])},s.getAllCast=function(e){s.state.script.updateCast(e)},s.getAllScenes=function(e){s.state.script.updateScene(e)},s.getSelectedCast=function(e){s.setState({selectedCastId:e.id},(function(){s.setState({allMessages:s.state.script.getAllMessagesAsNodes()})}))},s.getSelectedScene=function(e){s.setState({selectedSceneId:e.id},(function(){s.setState({allMessages:s.state.script.getAllMessagesAsNodes()})}))},s.getSelectedMsgType=function(e){s.setState({textMsg:e},(function(){s.addNewMessage()}))},s.alreadyBeenLikedByselectedCastId=function(e){var t=""+e+s.state.selectedCastId;return!!s.state.likedByMap.has(t)&&s.state.likedByMap.get(t)},s.addNewLikeMsg=function(e,t){if(s.alreadyBeenLikedByselectedCastId(e))s.deleteLikedMessage(e,s.state.selectedCastId);else{var n=Math.floor(Date.now()/1e3),a=s.state.timeSinceLastMsg;""!=a&&0!=a||(a=s.state.spslm);var i={id:n,timeStamp:n,msgType:"like",whoSentLikedMsg:t,idOfMsgLiked:e,whoLikedMsg:s.state.selectedCastId,tslmsg:a,sceneId:s.state.selectedSceneId};s.state.script.addNewMessage(i);var r=new Map(s.state.likedByMap);r.set(""+e+s.state.selectedCastId,!0),s.setState({likedByMap:r,allMessages:s.state.script.getAllMessagesAsNodes(),spslm:0})}},s.addNewMessage=function(){var e=Math.floor(Date.now()/1e3),t=s.state.timeSinceLastMsg;""!=t&&0!=t||(t=s.state.spslm);var n={id:e,timeStamp:e,content:s.state.textMsg,emotion:s.state.emotion,senderId:s.state.selectedCastId,tslmsg:t,msgType:"textMsg",sceneId:s.state.selectedSceneId};s.isActionMsg()&&(n.msgType="action"),s.isAuthorActionMsg()&&(n.msgType="authorAction"),s.state.script.addNewMessage(n),s.setState({allMessages:s.state.script.getOnlyTextMsgsAsNodes(),textMsg:"",emotion:"",spslm:0})},s.addNewMsgComment=function(e,t,n){var a=Math.floor(Date.now()/1e3),i=s.state.timeSinceLastMsg;""!=i&&0!=i||(i=s.state.spslm);var r={id:a,timeStamp:a,msgType:"comment",content:e,emotion:s.state.emotion,whoSentCommentedMsg:n,idOfMsgCommented:t,whoCommentedMsg:s.state.selectedCastId,tslmsg:i,sceneId:s.state.selectedSceneId};s.state.script.addNewMessage(r),s.setState({allMessages:s.state.script.getOnlyTextMsgsAsNodes(),textMsg:"",emotion:"",spslm:0})},s.addNewMediaMsg=function(e,t,n,a,i){var r=Math.floor(Date.now()/1e3),c=s.state.timeSinceLastMsg;""!=c&&0!=c||(c=s.state.spslm);var o={id:r,timeStamp:r,content:e,emotion:s.state.emotion,senderId:s.state.selectedCastId,tslmsg:c,isImg:n,isAudio:a,isVideo:i,msgType:"textMsg",url:t,sceneId:s.state.selectedSceneId};s.state.script.addNewMessage(o),s.setState({allMessages:s.state.script.getOnlyTextMsgsAsNodes(),textMsg:"",emotion:"",spslm:0})},s.getInputTime=function(e){s.setState({timeSinceLastMsg:e})},s.deleteMessage=function(e){s.state.script.deleteMessage(e),s.setState({allMessages:s.state.script.getOnlyTextMsgsAsNodes()},(function(){s.state.script.updateScriptFirebase()}))},s.onSaveComment=function(e,t,n){var a=s.state.script.getCommentNodeByCastIdMsgId(s.state.selectedCastId,t);a!=nil?s.state.script.editNodeContent(a.id,e):s.addNewMsgComment(e,t,n)},s.grabScreenshot=function(e){var t=document.getElementById("EditScript-chatArea-id");b()(t).then((function(e){var t=e.toDataURL(),n=Math.floor(Date.now()/1e3);S.default.storage().ref("ScreenShot/"+n).putString(t,"data_url").then((function(e){e.ref.getDownloadURL().then((function(e){s.addNewMediaMsg("ScreenShot",e,!0,!1,!1)}))}))}))},s.getInsertedImg=function(e){s.addNewMediaMsg("InsertImage",e,!0,!1,!1)},s.getUplodedVideo=function(e){s.addNewMediaMsg("UploadedVideo",e,!1,!1,!0)},s.getVNURL=function(e){s.addNewMediaMsg("VoiceNote",e,!1,!0,!1)},s.state={animateGreeting:"EditScript-animategreeting",orderId:"",script:e.script?e.script:null,isNewScript:e.isNewScript,selectedCastId:1,selectedSceneId:1,selectedMsgType:"",timeSinceLastMsg:"",textMsg:"",emotion:"",allMessages:[],spslm:0,likedByMap:e.script?e.script.getOnlyLikedMsgsAsNodes():new Map},s}return(0,s.default)(n,[{key:"componentWillUnmount",value:function(){clearInterval(this.intervalId)}},{key:"componentDidMount",value:function(){var e=this;if(window.location.href.includes("?/")){var t=window.location.href.split("?/")[1];this.props.history.push({pathname:"/"+t})}if(this.state.isNewScript)this.setState({likedByMap:this.generateLikedMap(this.state.script.getOnlyLikedMsgsAsNodes())});else{var n=window.location.pathname.replaceAll("/editscript/","");if(""!=n){var a=new m.default(n);a.grabScriptFromFirebase(n).then((function(){e.setState({script:a,likedByMap:e.generateLikedMap(a.getOnlyLikedMsgsAsNodes())})}))}}this.intervalId=setInterval((function(){e.setState({spslm:e.state.spslm+1})}),1e3)}},{key:"generateLikedMap",value:function(e){for(var t,n=new Map,a=A(e);!(t=a()).done;){var s=t.value,i=""+s.msgLikedId+s.msgLikedSenderId;n.set(i,!0)}return n}},{key:"deleteLikedMessage",value:function(e,t){this.setState({likedByMap:this.state.likedByMap.set(""+e+t,!1)});var n=this.state.script.getOnlyLikedMsgsAsNodes().find((function(n){return n.idOfMsgLiked===e&&n.whoLikedMsg===t}));n.id&&this.deleteMessage(n.id)}},{key:"isActionMsg",value:function(){return"y:"==this.state.emotion}},{key:"isAuthorActionMsg",value:function(){return"yy:"==this.state.emotion}},{key:"componentDidUpdate",value:function(){this.state.script&&this.state.script.updateScriptFirebase()}},{key:"render",value:function(){var e=this;return this.state.script?o.createElement("div",{className:"EditScript"},o.createElement("div",{className:"EditScript-container l-container"},o.createElement("div",{className:"EditScript-title"},o.createElement(g,{name:this.state.script.getScriptName(),getScriptName:this.getScriptName})),o.createElement("div",{className:"EditScript-scenes"},o.createElement(v,{scenes:this.state.script.getAllScenes(),selectedScene:this.getSelectedScene,getAllScenes:this.getAllScenes})),o.createElement("div",{className:"EditScript-cast"},o.createElement(h,{cast:this.state.script.getAllCast(),selectedCast:this.getSelectedCast,getAllCast:this.getAllCast})),o.createElement("div",{className:"EditScript-textView"},o.createElement(E,{grabScreenshot:this.grabScreenshot,getInsertedImg:this.getInsertedImg,selectedMsgType:this.getSelectedMsgType,getUplodedVideo:this.getUplodedVideo,getVNURL:this.getVNURL}),o.createElement("div",{id:"EditScript-chatArea-id",className:"EditScript-chatArea"},0==this.state.allMessages.length&&o.createElement("span",{className:"EditScript-castMemberPrompt"},"click on a cast member to see messages"),this.state.allMessages.map((function(t,n){return t.sceneId==e.state.selectedSceneId&&o.createElement(P,{key:n,isActive:t.senderId==e.state.selectedCastId&&"authorAction"!=t.msgType,message:t,index:n},t.isImg&&o.createElement("img",{className:"EditScript-imgMsg",src:t.url}),t.isAudio&&o.createElement("audio",{className:"EditScript-audioMsg",src:t.url,controls:!0}),t.isVideo&&o.createElement("video",{className:"EditScript-videoMsg",src:t.url,controls:!0}),"like"==t.msgType&&e.state.script.getNodeByMessageId(t.idOfMsgLiked)&&o.createElement("div",{className:"ReaderView-msgLike"},o.createElement("span",null,e.state.script.getSenderNameFromID(t.whoLikedMsg),"\xa0 liked message\xa0",e.state.script.getNodeByMessageId(t.idOfMsgLiked).data.MsgIndex,"\xa0 by\xa0",e.state.script.getSenderNameFromID(t.whoSentLikedMsg),"\xa0")),"action"==t.msgType&&o.createElement("div",{className:"EditScript-msgTypeAction glowing-text"},o.createElement("span",{className:"EditScript-senderName"},e.state.script.getSenderNameFromID(t.senderId)),o.createElement("span",null,"y: ",t.content)),"authorAction"==t.msgType&&o.createElement("div",{className:"EditScript-msgTypeAuthorAction glowing-text"},o.createElement("div",{className:"EditScript-content"},"yy: ",t.content)),"action"!=t.msgType&&"authorAction"!=t.msgType&&o.createElement("div",{className:"EditScript-isnotactionMsg"},o.createElement("span",{className:"EditScript-senderName"},e.state.script.getSenderNameFromID(t.senderId)),o.createElement("span",{className:"EditScript-senderEmotion"},t.emotion?"("+t.emotion+")":""),o.createElement("span",null,t.content)),o.createElement("span",{className:"EditScript-msgIndex"},t.MsgIndex),o.createElement("div",{className:"EditScript-chatArea-msg-buttons"},o.createElement("button",{className:"EditScript-chatArea-msg-button",onClick:function(){return e.deleteMessage(t.id)}},"Delete"),o.createElement("button",{className:"EditScript-chatArea-msg-button",onClick:function(){return e.addNewLikeMsg(t.id,t.senderId)}},e.alreadyBeenLikedByselectedCastId(t.id)?"Unlike":"Like"),o.createElement(k,{className:"EditScript-chatArea-msg-button",idOfMsgCommented:t.id,whoSentCommentedMsg:t.senderId,onSave:e.onSaveComment,alreadySavedValue:e.state.script.getCommentByCastIdMsgId(e.state.selectedCastId,t.id)})))}))),o.createElement("div",{className:"EditScript-sendMessage"},o.createElement(l.default,{variant:"outlined",className:"EditScript-sendMessage--input",value:this.state.textMsg,placeholder:"Type message here",onChange:function(t){e.setState({textMsg:t.target.value})}}),o.createElement(l.default,{variant:"outlined",className:"EditScript-emotions--input",value:this.state.emotion,placeholder:"Type emotion here",onChange:function(t){e.setState({emotion:t.target.value})}}),o.createElement(C,{inputTime:this.getInputTime})),o.createElement("div",{className:"EditScript-saveSubmit"},o.createElement("div",null,o.createElement(w.default,{className:"EditScript-saveSubmit--send",variant:"outlined",color:"primary",onClick:function(){return e.addNewMessage()}},"Send")),o.createElement("div",null,o.createElement(w.default,{className:"EditScript-saveSubmit--save",variant:"outlined",color:"primary",onClick:function(){return e.state.script.updateScriptFirebase()}},"save")))))):o.createElement("div",{className:"is-loading"},"script loading...")}}]),n}(o.Component),R=(0,u.withRouter)((0,d.connect)((function(e){return{}}))(x));const O=(0,u.withRouter)(R);var P=function(e){return e.isActive?o.createElement("div",{className:"EditScript-chatArea-msg active"},e.children):o.createElement("div",{className:"EditScript-chatArea-msg"},e.children)}},9268:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var a=n(5671),s=n(3144),i=n(136),r=n(2963),c=n(1120),o=n(9526),l=n(2246),d=n(9934),u=n(536),m=n(5463);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,c.default)(e);if(t){var s=(0,c.default)(this).constructor;n=Reflect.construct(a,arguments,s)}else n=a.apply(this,arguments);return(0,r.default)(this,n)}}var g=new u.default("NewScript"),p=function(e){(0,i.default)(n,e);var t=f(n);function n(e){var s;return(0,a.default)(this,n),(s=t.call(this,e)).state={script:g},s}return(0,s.default)(n,[{key:"render",value:function(){return o.createElement("div",{className:"NewScript"},o.createElement(m.default,{isNewScript:!0,script:this.state.script}))}}]),n}(o.Component),h=(0,d.withRouter)((0,l.connect)((function(e){return{}}))(p));const v=(0,d.withRouter)(h)},536:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(3144),s=n(5671),i=(n(9526),n(7586));function r(e,t){var n="undefined"!==typeof Symbol&&e["function"===typeof Symbol?Symbol.iterator:"@@iterator"]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var o=(0,a.default)((function e(t){(0,s.default)(this,e),this.data=t,this.next=null}));const l=function(){function e(t){(0,s.default)(this,e);var n=Math.floor(Date.now()/1e3);this.name=t,this.dateCreated=n,this.id=t+n,this.cast=[],this.crew=[],this.scenes=[],this.head=null,this.messages=new o,this.node={},this.totalNoMsgs=0,this.readerReactionMap=new Map,this.isPrivateScript=!1}return(0,a.default)(e,[{key:"updateScriptName",value:function(e){this.name=e,this.updateIsPrivateScript()}},{key:"updateIsPrivateScript",value:function(){this.name.startsWith("yyyy")&&(this.isPrivateScript=!0)}},{key:"numberOfMessages",value:function(){for(var e=0,t=this.head;t;)e++,t=t.next;return e}},{key:"getScenes",value:function(){return this.scenes}},{key:"updateReaderReaction",value:function(e,t){this.readerReactionMap.has(t)||this.readerReactionMap.set(t,[]),this.readerReactionMap.get(t).push(e),this.updateScriptFirebase()}},{key:"getReaderReactionMap",value:function(){return this.readerReactionMap}},{key:"getTotalNumScenes",value:function(){return this.getScenes().length}},{key:"deleteScript",value:function(){this.head=null}},{key:"getLastMessage",value:function(){for(var e=this.head;e.next;)e=e.next;return e.data.content}},{key:"getFirstMessage",value:function(){return this.head}},{key:"addNewMessage",value:function(e){this.totalNoMsgs+=1,e.MsgIndex=this.totalNoMsgs;var t=new o(e);if(!this.head)return this.head=t,this.head;for(var n=this.head;n.next;)n=n.next;n.next=t}},{key:"deleteMessage",value:function(e){if(this.head.data.id===e)this.head=this.head.next;else for(var t=this.head;t.next;){if(t.next.data.id===e){t.next=t.next.next;break}t=t.next}return this.head}},{key:"getNthMessage",value:function(e){e-=1;for(var t=this.head,n=0;n<e;n++){if(!t)return"";t=t.next}return t.data.content}},{key:"getNthMessageNode",value:function(e){e-=1;for(var t=this.head,n=0;n<e;n++){if(!t.next)return"";t=t.next}return t?t.data:null}},{key:"getAllMessagesStringList",value:function(){for(var e=[],t=this.head;t;)e.push(t.data.content),t=t.next;return e}},{key:"getAllMessagesStringListBySenderId",value:function(e){for(var t=[],n=this.head;n;)n.data.senderId==e&&t.push(n.data),n=n.next;return t}},{key:"getOnlyTextMsgsAsNodes",value:function(){for(var e=[],t=this.head;t;)"textMsg"==t.data.msgType&&e.push(t.data),t=t.next;return e}},{key:"getOnlyCommentsAsNodes",value:function(){for(var e=[],t=this.head;t;)"comment"==t.data.msgType&&e.push(t.data),t=t.next;return e}},{key:"getCommentByCastIdMsgId",value:function(e,t){var n=this.getOnlyCommentsAsNodes().find((function(n){return n.whoCommentedMsg===e&&n.idOfMsgCommented===t}));return n?n.content:""}},{key:"getCommentNodeByCastIdMsgId",value:function(e,t){return this.getOnlyCommentsAsNodes().find((function(n){return n.whoCommentedMsg===e&&n.idOfMsgCommented===t}))}},{key:"editNodeContent",value:function(e,t){for(var n=this.head;n;){if(n.data.id===e){n.data.content=t;break}n=n.next}this.updateScriptFirebase()}},{key:"getOnlyLikedMsgsAsNodes",value:function(){for(var e=[],t=this.head;t;)"like"==t.data.msgType&&e.push(t.data),t=t.next;return e}},{key:"getAllMessagesAsNodes",value:function(){for(var e=[],t=this.head;t;)e.push(t.data),t=t.next;return e}},{key:"getSenderNameFromID",value:function(e){var t=this.getAllCast().concat(this.getAllCrew()).find((function(t){return t.id===e}));return t?t.name:""}},{key:"sendScriptToFirebase",value:function(){var e={id:this.id,name:this.name,dateCreated:this.dateCreated,cast:this.getAllCast(),crew:this.getAllCrew(),messages:this.getAllMessagesAsNodes(),scenes:this.getAllScenes(),isPrivateScript:this.isPrivateScript};i.default.createNewScript(e)}},{key:"updateCast",value:function(e){this.cast=e}},{key:"updateScene",value:function(e){this.scenes=e}},{key:"isEmptyScript",value:function(){return"NewScript"==this.name}},{key:"updateScriptFirebase",value:function(){if(!this.isEmptyScript()){var e={id:this.id,name:this.name,dateCreated:this.dateCreated,cast:this.getAllCast(),crew:this.getAllCrew(),messages:this.getAllMessagesAsNodes(),scenes:this.getAllScenes(),readerReactionMap:JSON.stringify(Object.fromEntries(this.readerReactionMap)),isPrivateScript:this.isPrivateScript};i.default.updateScript(e)}}},{key:"removeCast",value:function(e){var t=[];this.cast.forEach((function(n){n.id!=e.id&&t.push(n)})),this.cast=t}},{key:"addNewCrew",value:function(e){this.crew.push(e)}},{key:"getAllCast",value:function(){return this.cast}},{key:"getAllScenes",value:function(){return this.scenes}},{key:"getCastIdToName",value:function(){for(var e,t=new Map,n=r(this.getAllCast);!(e=n()).done;){var a=e.value;t.set(a.id,a.name)}return t}},{key:"getAllCrew",value:function(){return this.crew}},{key:"removeCrew",value:function(e){var t=[];this.crew.forEach((function(n){n.id!=e.id&&t.push(n)})),this.crew=t}},{key:"getScriptName",value:function(){return this.name}},{key:"grabScriptFromFirebase",value:function(e){var t=this;return new Promise((function(n){i.default.getScriptById(e).then((function(e){if(e.messages)for(var n=e.messages,a=0;a<n.length;a++)t.addNewMessage(n[a]);var s=new Map;if(e.readerReactionMap){var i=JSON.parse(e.readerReactionMap);s=new Map(Object.entries(i))}t.name=e.name,t.dateCreated=e.dateCreated,t.id=e.id,t.cast=e.cast?e.cast:[],t.crew=e.crew?e.crew:[],t.scenes=e.scenes?e.scenes:[],t.readerReactionMap=s,t.isPrivateScript=!!e.isPrivateScript&&e.isPrivateScript})).then((function(){n(t)}))}))}},{key:"getNodeByMessageId",value:function(e){for(var t=this.head;t;){if(t.data.id===e)return t;t=t.next}return null}},{key:"getMsgType",value:function(e){var t=getNodeByMessageId(e);return t.msgType?t.msgType:"textMsg"}}]),e}()},7586:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var a=n(3144),s=n(5671),i=n(2805),r=n.n(i);const c=new((0,a.default)((function e(){(0,s.default)(this,e),this.getScripts=function(){return new Promise((function(e){r().database().ref("/scripts/").once("value").then((function(t){t.val()?e(Object.values(t.val())):e({})}))}))},this.getFylds=function(){return new Promise((function(e){r().database().ref("/fylds/").once("value").then((function(t){t.val()?e(Object.values(t.val())):e({})}))}))},this.createFyld=function(e){return new Promise((function(t){r().database().ref("/fylds/"+e.name.replace(/\s/g,"")+"/").set({name:e.name,dateCreated:e.dateCreated,description:e.description,image:e.image,friends:e.friends}).then((function(e){console.log("response",e),t(!0)})).catch((function(e){console.log("error",e)}))}))},this.createNewScript=function(e){return new Promise((function(t){r().database().ref("/scripts/"+e.id+"/").set({id:e.id,name:e.name,dateCreated:e.dateCreated,cast:e.cast,crew:e.crew,messages:e.messages,isPrivateScript:e.isPrivateScript}).then((function(e){console.log("response",e),t(!0)})).catch((function(e){console.log("error",e)}))}))},this.updateScript=function(e){return new Promise((function(t){r().database().ref("/scripts/"+e.id+"/").update({id:e.id,name:e.name,dateCreated:e.dateCreated,cast:e.cast,crew:e.crew,messages:e.messages,scenes:e.scenes,readerReactionMap:e.readerReactionMap,isPrivateScript:e.isPrivateScript}).then((function(e){console.log("response",e),t(!0)})).catch((function(e){console.log("error",e)}))}))},this.getOpenAIAPI=function(){return new Promise((function(e){r().database().ref("/openAIAPI/").once("value").then((function(t){t.val()?e(Object.values(t.val())):e({})}))}))},this.getConversationHistory=function(){return new Promise((function(e){r().database().ref("/conversationHistory/").once("value").then((function(t){t.val()?e(Object.values(t.val())):e({})}))}))},this.getRimiSenTitles=function(){return new Promise((function(e){r().database().ref("/rimiLyrics/").once("value").then((function(t){t.val()?e(Object.values(t.val())):e({})}))}))},this.postChats=function(e,t,n,a,s){return new Promise((function(i){r().database().ref("/chats/"+e+"/"+a+"/"+t+"/").push({content:n,timestamp:Date.now(),uid:s}).then((function(){i(!0)})).catch((function(e){i({})}))}))},this.storage=function(){return r().storage()},this.getRimiSenTitles=function(){return new Promise((function(e){r().database().ref("/rimiLyrics/").once("value").then((function(t){t.val()?e(Object.values(t.val())):e({})}))}))},this.getScriptById=function(e){return new Promise((function(t){r().database().ref("/scripts/"+e).once("value").then((function(e){e.val()?t(Object(e.val())):t({})}))}))},this.updateSenTitle=function(e){return new Promise((function(t){r().database().ref("/rimis/"+e.id+"/").update({senTitle:e.newSenTitle}).then((function(n){return new Promise((function(t){r().database().ref("/rimis/"+e.id+"/updates/"+e.updateId).remove().then((function(){t(!0)})).catch((function(e){console.log("error",e)}))})).then((function(e){t(!0)})).catch((function(e){console.log("error",e)}))})).catch((function(e){console.log("error",e)}))}))},this.sendForApproval=function(e){return new Promise((function(t){r().database().ref("/rimis/"+e.id+"/updates/"+e.updateId+"/").set(e).then((function(e){console.log("response",e),t(!0)})).catch((function(e){console.log("error",e)}))}))},this.updateVideoSnippetURL=function(e,t){return new Promise((function(n){r().database().ref("/orders/"+e+"/").update({snippetVideoURL:t}).then((function(e){console.log("response",e),n(!0)})).catch((function(e){console.log("error",e)}))}))}})))}}]);
//# sourceMappingURL=423.d2bca9c7.chunk.js.map