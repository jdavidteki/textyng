{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jdavid/Documents/textyng/src/components/EditScript/EditScript.js\";\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport React, { Component } from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport Script from \"../Script/Script.js\";\nimport EditableField from \"../EditableField/EditableField\";\nimport CastMembers from \"../CastMembers/CastMembers\";\nimport Scenes from \"../Scenes/Scenes\";\nimport MsgTypes from \"../MsgTypes/MsgTypes\";\nimport Button from \"@material-ui/core/Button\";\nimport TimeInput from \"../TimeInput/TimeInput.js\";\nimport CommentedPopup from \"../CommentedPopup/CommentedPopup.js\";\nimport html2canvas from 'html2canvas';\nimport Firebase from \"../../firebase/firebase\";\nimport \"./EditScript.css\";\nimport { nil } from \"ajv\";\nvar ConnectedEditScript = function (_Component) {\n  _inherits(ConnectedEditScript, _Component);\n  var _super = _createSuper(ConnectedEditScript);\n  function ConnectedEditScript(props) {\n    var _this;\n    _classCallCheck(this, ConnectedEditScript);\n    _this = _super.call(this, props);\n    _this.getScriptName = function (name) {\n      _this.state.script.UpdateScriptName(name[1]);\n    };\n    _this.getAllCast = function (cast) {\n      _this.state.script.updateCast(cast);\n    };\n    _this.getAllScenes = function (scenes) {\n      console.log(\"allscences\", scenes);\n      _this.state.script.updateScene(scenes);\n    };\n    _this.getSelectedCast = function (cast) {\n      _this.setState({\n        selectedCastId: cast.id\n      }, function () {\n        _this.setState({\n          allMessages: _this.state.script.getOnlyTextMsgsAsNodes()\n        });\n      });\n    };\n    _this.getSelectedScene = function (scene) {\n      _this.setState({\n        selectedSceneId: scene.id\n      }, function () {\n        _this.setState({\n          allMessages: _this.state.script.getOnlyTextMsgsAsNodes()\n        });\n      });\n    };\n    _this.getSelectedMsgType = function (value) {\n      _this.setState({\n        textMsg: value\n      }, function () {\n        _this.addNewMessage();\n      });\n    };\n    _this.alreadyBeenLikedByselectedCastId = function (messageId) {\n      var likedMsgID = \"\" + messageId + _this.state.selectedCastId;\n      if (_this.state.likedByMap.has(likedMsgID)) {\n        return _this.state.likedByMap.get(likedMsgID);\n      }\n      return false;\n    };\n    _this.addNewLikeMsg = function (messageId, senderId) {\n      if (!_this.alreadyBeenLikedByselectedCastId(messageId)) {\n        var milliseconds = Math.floor(Date.now() / 1000);\n        var tslmsg = _this.state.timeSinceLastMsg;\n        if (tslmsg == \"\" || tslmsg == 0) {\n          tslmsg = _this.state.spslm;\n        }\n        var msgData = {\n          id: milliseconds,\n          timeStamp: milliseconds,\n          msgType: \"like\",\n          whoSentLikedMsg: senderId,\n          idOfMsgLiked: messageId,\n          whoLikedMsg: _this.state.selectedCastId,\n          tslmsg: tslmsg,\n          sceneId: _this.state.selectedSceneId\n        };\n        _this.state.script.addNewMessage(msgData);\n        var updatedLikedByMap = new Map(_this.state.likedByMap);\n        updatedLikedByMap.set(\"\" + messageId + _this.state.selectedCastId, true);\n        _this.setState({\n          likedByMap: updatedLikedByMap,\n          allMessages: _this.state.script.getOnlyTextMsgsAsNodes(),\n          spslm: 0\n        });\n      } else {\n        _this.deleteLikedMessage(messageId, _this.state.selectedCastId);\n      }\n    };\n    _this.addNewMessage = function () {\n      var milliseconds = Math.floor(Date.now() / 1000);\n      var tslmsg = _this.state.timeSinceLastMsg;\n      if (tslmsg == \"\" || tslmsg == 0) {\n        tslmsg = _this.state.spslm;\n      }\n      var msgData = {\n        id: milliseconds,\n        timeStamp: milliseconds,\n        content: _this.state.textMsg,\n        senderId: _this.state.selectedCastId,\n        tslmsg: tslmsg,\n        msgType: \"textMsg\",\n        sceneId: _this.state.selectedSceneId\n      };\n      _this.state.script.addNewMessage(msgData);\n      _this.setState({\n        allMessages: _this.state.script.getOnlyTextMsgsAsNodes(),\n        textMsg: \"\",\n        spslm: 0\n      });\n    };\n    _this.addNewMsgComment = function (comment, idOfMsgCommented, whoSentCommentedMsg) {\n      var milliseconds = Math.floor(Date.now() / 1000);\n      var tslmsg = _this.state.timeSinceLastMsg;\n      if (tslmsg == \"\" || tslmsg == 0) {\n        tslmsg = _this.state.spslm;\n      }\n      var msgData = {\n        id: milliseconds,\n        timeStamp: milliseconds,\n        msgType: \"comment\",\n        content: comment,\n        whoSentCommentedMsg: whoSentCommentedMsg,\n        idOfMsgCommented: idOfMsgCommented,\n        whoCommentedMsg: _this.state.selectedCastId,\n        tslmsg: tslmsg,\n        sceneId: _this.state.selectedSceneId\n      };\n      _this.state.script.addNewMessage(msgData);\n      _this.setState({\n        allMessages: _this.state.script.getOnlyTextMsgsAsNodes(),\n        textMsg: \"\",\n        spslm: 0\n      });\n    };\n    _this.addNewMediaMsg = function (mediaType, mediaURL, isImg, isAudio, isVideo) {\n      var milliseconds = Math.floor(Date.now() / 1000);\n      var tslmsg = _this.state.timeSinceLastMsg;\n      if (tslmsg == \"\" || tslmsg == 0) {\n        tslmsg = _this.state.spslm;\n      }\n      var msgData = {\n        id: milliseconds,\n        timeStamp: milliseconds,\n        content: mediaType,\n        senderId: _this.state.selectedCastId,\n        tslmsg: tslmsg,\n        isImg: isImg,\n        isAudio: isAudio,\n        isVideo: isVideo,\n        msgType: \"textMsg\",\n        url: mediaURL,\n        sceneId: _this.state.selectedSceneId\n      };\n      _this.state.script.addNewMessage(msgData);\n      _this.setState({\n        allMessages: _this.state.script.getOnlyTextMsgsAsNodes(),\n        textMsg: \"\",\n        spslm: 0\n      });\n    };\n    _this.getInputTime = function (timeInSeconds) {\n      _this.setState({\n        timeSinceLastMsg: timeInSeconds\n      });\n    };\n    _this.deleteMessage = function (id) {\n      _this.state.script.deleteMessage(id);\n      _this.setState({\n        allMessages: _this.state.script.getOnlyTextMsgsAsNodes()\n      }, function () {\n        _this.state.script.updateScriptFirebase();\n      });\n    };\n    _this.onSaveComment = function (message, idOfMsgCommented, whoSentCommentedMsg) {\n      var existingCommentNode = _this.state.script.getCommentNodeByCastIdMsgId(_this.state.selectedCastId, idOfMsgCommented);\n      if (existingCommentNode != nil) {\n        _this.state.script.editNodeContent(existingCommentNode.id, message);\n      } else {\n        _this.addNewMsgComment(message, idOfMsgCommented, whoSentCommentedMsg);\n      }\n    };\n    _this.grabScreenshot = function (url) {\n      var element = document.getElementById('EditScript-chatArea-id');\n      html2canvas(element).then(function (canvas) {\n        var imageData = canvas.toDataURL();\n        var milliseconds = Math.floor(Date.now() / 1000);\n        var storageRef = Firebase.storage().ref(\"ScreenShot/\" + milliseconds);\n        storageRef.putString(imageData, 'data_url').then(function (snapshot) {\n          snapshot.ref.getDownloadURL().then(function (downloadURL) {\n            console.log(\"Image URL: \" + downloadURL);\n            _this.addNewMediaMsg(\"ScreenShot\", downloadURL, true, false, false);\n          });\n        });\n      });\n    };\n    _this.getInsertedImg = function (url) {\n      console.log(\"url\", url);\n      _this.addNewMediaMsg(\"InsertImage\", url, true, false, false);\n    };\n    _this.getUplodedVideo = function (url) {\n      console.log(\"url\", url);\n      _this.addNewMediaMsg(\"UploadedVideo\", url, false, false, true);\n    };\n    _this.getVNURL = function (url) {\n      console.log(\"url\", url);\n      _this.addNewMediaMsg(\"VoiceNote\", url, false, true, false);\n    };\n    _this.state = {\n      rimis: [],\n      rimisIds: [],\n      filteredRimis: [],\n      rimiToShow: null,\n      animateGreeting: \"EditScript-animategreeting\",\n      orderId: \"\",\n      script: null,\n      selectedCastId: 1,\n      selectedSceneId: 1,\n      selectedMsgType: \"\",\n      timeSinceLastMsg: \"\",\n      textMsg: \"\",\n      allMessages: [],\n      spslm: 0,\n      likedByMap: new Map()\n    };\n    return _this;\n  }\n  _createClass(ConnectedEditScript, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.intervalId);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n      var scriptId = window.location.pathname.replaceAll(\"/editscript/\", \"\");\n      if (scriptId != \"\") {\n        var textyng = new Script(scriptId);\n        textyng.grabScriptFromFirebase(scriptId).then(function () {\n          _this2.setState({\n            script: textyng,\n            likedByMap: _this2.generateLikedMap(textyng.getOnlyLikedMsgsAsNodes())\n          });\n        });\n      }\n      this.intervalId = setInterval(function () {\n        _this2.setState({\n          spslm: _this2.state.spslm + 1\n        });\n      }, 1000);\n    }\n  }, {\n    key: \"generateLikedMap\",\n    value: function generateLikedMap(likedMessages) {\n      var map = new Map();\n      for (var _iterator = _createForOfIteratorHelperLoose(likedMessages), _step; !(_step = _iterator()).done;) {\n        var obj = _step.value;\n        var key = \"\" + obj.msgLikedId + obj.msgLikedSenderId;\n        map.set(key, true);\n      }\n      return map;\n    }\n  }, {\n    key: \"deleteLikedMessage\",\n    value: function deleteLikedMessage(messageId, whoLikedMsg) {\n      this.setState({\n        likedByMap: this.state.likedByMap.set(\"\" + messageId + whoLikedMsg, false)\n      });\n      var allMessages = this.state.script.getOnlyLikedMsgsAsNodes();\n      var result = allMessages.find(function (obj) {\n        return obj.idOfMsgLiked === messageId && obj.whoLikedMsg === whoLikedMsg;\n      });\n      if (result.id) {\n        this.deleteMessage(result.id);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      if (this.state.script) {\n        this.state.script.updateScriptFirebase();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n      if (this.state.script) {\n        return React.createElement(\"div\", {\n          className: \"EditScript\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 13\n          }\n        }, React.createElement(\"div\", {\n          className: \"EditScript-container l-container\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 17\n          }\n        }, React.createElement(\"div\", {\n          className: \"EditScript-title\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 21\n          }\n        }, React.createElement(EditableField, {\n          name: this.state.script.getScriptName(),\n          getScriptName: this.getScriptName,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 23\n          }\n        })), React.createElement(\"div\", {\n          className: \"EditScript-scenes\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 21\n          }\n        }, React.createElement(Scenes, {\n          scenes: this.state.script.getAllScenes(),\n          selectedScene: this.getSelectedScene,\n          getAllScenes: this.getAllScenes,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 23\n          }\n        })), React.createElement(\"div\", {\n          className: \"EditScript-cast\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 21\n          }\n        }, React.createElement(CastMembers, {\n          cast: this.state.script.getAllCast(),\n          selectedCast: this.getSelectedCast,\n          getAllCast: this.getAllCast,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 23\n          }\n        })), React.createElement(\"div\", {\n          className: \"EditScript-textView\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 333,\n            columnNumber: 21\n          }\n        }, React.createElement(MsgTypes, {\n          grabScreenshot: this.grabScreenshot,\n          getInsertedImg: this.getInsertedImg,\n          selectedMsgType: this.getSelectedMsgType,\n          getUplodedVideo: this.getUplodedVideo,\n          getVNURL: this.getVNURL,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 23\n          }\n        }), React.createElement(\"div\", {\n          id: \"EditScript-chatArea-id\",\n          className: \"EditScript-chatArea\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 341,\n            columnNumber: 23\n          }\n        }, this.state.allMessages.length == 0 && React.createElement(\"span\", {\n          className: \"EditScript-castMemberPrompt\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 27\n          }\n        }, \"click on a cast member to see messages\"), this.state.allMessages.map(function (value, index) {\n          return value.sceneId == _this3.state.selectedSceneId && React.createElement(DynamicClassAssignment, {\n            key: index,\n            isActive: value.senderId == _this3.state.selectedCastId,\n            value: value,\n            index: index,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 27\n            }\n          }, value.isImg && React.createElement(\"img\", {\n            className: \"EditScript-imgMsg\",\n            src: value.url,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 350,\n              columnNumber: 31\n            }\n          }), value.isAudio && React.createElement(\"audio\", {\n            className: \"EditScrip-audioMsg\",\n            src: value.url,\n            controls: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 356,\n              columnNumber: 31\n            }\n          }), value.isVideo && React.createElement(\"video\", {\n            className: \"EditScript-videoMsg\",\n            src: value.url,\n            controls: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 363,\n              columnNumber: 31\n            }\n          }), React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 29\n            }\n          }, React.createElement(\"span\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 370,\n              columnNumber: 31\n            }\n          }, value.content), React.createElement(\"span\", {\n            className: \"EditScript-senderName\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 31\n            }\n          }, _this3.state.script.getSenderNameFromID(value.senderId))), React.createElement(\"div\", {\n            className: \"EditScript-chatArea-msg-buttons\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 373,\n              columnNumber: 29\n            }\n          }, React.createElement(\"button\", {\n            className: \"EditScript-chatArea-msg-button\",\n            onClick: function onClick() {\n              return _this3.deleteMessage(value.id);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 31\n            }\n          }, \"Delete\"), React.createElement(\"button\", {\n            className: \"EditScript-chatArea-msg-button\",\n            onClick: function onClick() {\n              return _this3.addNewLikeMsg(value.id, value.senderId);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 375,\n              columnNumber: 31\n            }\n          }, _this3.alreadyBeenLikedByselectedCastId(value.id) ? \"Unlike\" : \"Like\"), React.createElement(CommentedPopup, {\n            className: \"EditScript-chatArea-msg-button\",\n            idOfMsgCommented: value.id,\n            whoSentCommentedMsg: value.senderId,\n            onSave: _this3.onSaveComment,\n            alreadySavedValue: _this3.state.script.getCommentByCastIdMsgId(_this3.state.selectedCastId, value.id),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 376,\n              columnNumber: 31\n            }\n          })));\n        })), React.createElement(\"div\", {\n          className: \"EditScript-sendMessage\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 23\n          }\n        }, React.createElement(TextField, {\n          variant: \"outlined\",\n          className: \"EditScript-sendMessage--input\",\n          value: this.state.textMsg,\n          placeholder: \"Type message here\",\n          onChange: function onChange(e) {\n            _this3.setState({\n              textMsg: e.target.value\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 25\n          }\n        }), React.createElement(TimeInput, {\n          inputTime: this.getInputTime,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 398,\n            columnNumber: 25\n          }\n        })), React.createElement(\"div\", {\n          className: \"EditScript-saveSubmit\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 23\n          }\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 25\n          }\n        }, React.createElement(Button, {\n          className: \"EditScript-saveSubmit--save\",\n          variant: \"outlined\",\n          color: \"primary\",\n          onClick: function onClick() {\n            return _this3.state.script.updateScriptFirebase();\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 27\n          }\n        }, \"save\")), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 412,\n            columnNumber: 25\n          }\n        }, React.createElement(Button, {\n          className: \"EditScript-saveSubmit--send\",\n          variant: \"outlined\",\n          color: \"primary\",\n          onClick: function onClick() {\n            return _this3.addNewMessage();\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 27\n          }\n        }, \"Send\"))))));\n      } else {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 13\n          }\n        }, \"script loading...\");\n      }\n    }\n  }]);\n  return ConnectedEditScript;\n}(Component);\nvar mapStateToProps = function mapStateToProps(state) {\n  return {};\n};\nvar EditScript = withRouter(connect(mapStateToProps)(ConnectedEditScript));\nexport default withRouter(EditScript);\nvar DynamicClassAssignment = function DynamicClassAssignment(props) {\n  if (props.isActive) {\n    return React.createElement(\"div\", {\n      className: \"EditScript-chatArea-msg active\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 13\n      }\n    }, props.children);\n  } else {\n    return React.createElement(\"div\", {\n      className: \"EditScript-chatArea-msg\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 453,\n        columnNumber: 13\n      }\n    }, props.children);\n  }\n};","map":{"version":3,"names":["React","Component","TextField","connect","withRouter","Script","EditableField","CastMembers","Scenes","MsgTypes","Button","TimeInput","CommentedPopup","html2canvas","Firebase","nil","ConnectedEditScript","props","getScriptName","name","state","script","UpdateScriptName","getAllCast","cast","updateCast","getAllScenes","scenes","console","log","updateScene","getSelectedCast","setState","selectedCastId","id","allMessages","getOnlyTextMsgsAsNodes","getSelectedScene","scene","selectedSceneId","getSelectedMsgType","value","textMsg","addNewMessage","alreadyBeenLikedByselectedCastId","messageId","likedMsgID","likedByMap","has","get","addNewLikeMsg","senderId","milliseconds","Math","floor","Date","now","tslmsg","timeSinceLastMsg","spslm","msgData","timeStamp","msgType","whoSentLikedMsg","idOfMsgLiked","whoLikedMsg","sceneId","updatedLikedByMap","Map","set","deleteLikedMessage","content","addNewMsgComment","comment","idOfMsgCommented","whoSentCommentedMsg","whoCommentedMsg","addNewMediaMsg","mediaType","mediaURL","isImg","isAudio","isVideo","url","getInputTime","timeInSeconds","deleteMessage","updateScriptFirebase","onSaveComment","message","existingCommentNode","getCommentNodeByCastIdMsgId","editNodeContent","grabScreenshot","element","document","getElementById","then","canvas","imageData","toDataURL","storageRef","storage","ref","putString","snapshot","getDownloadURL","downloadURL","getInsertedImg","getUplodedVideo","getVNURL","rimis","rimisIds","filteredRimis","rimiToShow","animateGreeting","orderId","selectedMsgType","clearInterval","intervalId","scriptId","window","location","pathname","replaceAll","textyng","grabScriptFromFirebase","generateLikedMap","getOnlyLikedMsgsAsNodes","setInterval","likedMessages","map","obj","key","msgLikedId","msgLikedSenderId","result","find","length","index","getSenderNameFromID","getCommentByCastIdMsgId","e","target","mapStateToProps","EditScript","DynamicClassAssignment","isActive","children"],"sources":["/Users/jdavid/Documents/textyng/src/components/EditScript/EditScript.js"],"sourcesContent":["import React, { Component } from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport Script from \"../Script/Script.js\";\nimport EditableField from \"../EditableField/EditableField\";\nimport CastMembers from \"../CastMembers/CastMembers\";\nimport Scenes from \"../Scenes/Scenes\";\nimport MsgTypes from \"../MsgTypes/MsgTypes\";\nimport Button from \"@material-ui/core/Button\";\nimport TimeInput from \"../TimeInput/TimeInput.js\"\nimport CommentedPopup from \"../CommentedPopup/CommentedPopup.js\"\nimport html2canvas from 'html2canvas';\nimport Firebase from \"../../firebase/firebase\";\n\nimport \"./EditScript.css\";\nimport { nil } from \"ajv\";\n\nclass ConnectedEditScript extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      rimis: [],\n      rimisIds: [],\n      filteredRimis: [],\n      rimiToShow: null,\n      animateGreeting: \"EditScript-animategreeting\",\n      orderId: \"\",\n      script: null,\n      selectedCastId: 1,\n      selectedSceneId: 1,\n      selectedMsgType: \"\",\n      timeSinceLastMsg: \"\",\n      textMsg: \"\",\n      allMessages: [],\n      spslm: 0,\n      likedByMap: new Map(),\n    };\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.intervalId);\n  }\n\n  componentDidMount() {\n    let scriptId = window.location.pathname.replaceAll(\"/editscript/\", \"\")\n\n    if(scriptId != \"\"){\n      var textyng = new Script(scriptId);\n      textyng.grabScriptFromFirebase(scriptId)\n      .then(() => {\n        this.setState({\n          script: textyng,\n          likedByMap: this.generateLikedMap(textyng.getOnlyLikedMsgsAsNodes())\n        })\n      })\n    }\n\n    this.intervalId = setInterval(() => {\n      this.setState({ spslm: this.state.spslm + 1 });\n    }, 1000);\n  }\n\n  generateLikedMap(likedMessages){\n    let map = new Map();\n\n    for (let obj of likedMessages) {\n      let key = `${obj.msgLikedId}${obj.msgLikedSenderId}`;\n      map.set(key, true);\n    }\n\n    return map\n  }\n\n  getScriptName = (name) => {\n    this.state.script.UpdateScriptName(name[1])\n  }\n\n  getAllCast = (cast) => {\n    this.state.script.updateCast(cast)\n  }\n\n  getAllScenes = (scenes) => {\n    console.log(\"allscences\", scenes)\n    this.state.script.updateScene(scenes)\n  }\n\n  getSelectedCast = (cast) => {\n    this.setState({selectedCastId: cast.id}, () => {\n      this.setState({allMessages: this.state.script.getOnlyTextMsgsAsNodes()})\n    })\n  }\n\n  getSelectedScene = (scene) => {\n    this.setState({selectedSceneId: scene.id}, () => {\n      this.setState({allMessages: this.state.script.getOnlyTextMsgsAsNodes()})\n    })\n  }\n\n  getSelectedMsgType = (value) => {\n    this.setState({ textMsg: value}, () => {\n      this.addNewMessage()\n    });\n  }\n\n  alreadyBeenLikedByselectedCastId = (messageId) => {\n    let likedMsgID = `${messageId}${this.state.selectedCastId}`\n\n    if(this.state.likedByMap.has(likedMsgID)){\n      return this.state.likedByMap.get(likedMsgID)\n    }\n    return false\n  }\n\n  deleteLikedMessage(messageId, whoLikedMsg){\n    this.setState({\n      likedByMap: this.state.likedByMap.set(`${messageId}${whoLikedMsg}`, false)\n    })\n\n    let allMessages = this.state.script.getOnlyLikedMsgsAsNodes()\n    const result = allMessages.find(obj => obj.idOfMsgLiked === messageId && obj.whoLikedMsg === whoLikedMsg);\n\n    if(result.id){\n      this.deleteMessage(result.id)\n    }\n  }\n\n  addNewLikeMsg = (messageId, senderId) => {\n    if(!this.alreadyBeenLikedByselectedCastId(messageId)){\n\n      var milliseconds = Math.floor(Date.now() / 1000)\n\n      let tslmsg = this.state.timeSinceLastMsg\n      if(tslmsg == \"\" || tslmsg == 0){\n        tslmsg = this.state.spslm\n      }\n      let msgData = {\n        id: milliseconds,\n        timeStamp: milliseconds,\n        msgType: \"like\",\n        whoSentLikedMsg: senderId,\n        idOfMsgLiked: messageId,\n        whoLikedMsg: this.state.selectedCastId,\n        tslmsg: tslmsg,\n        sceneId: this.state.selectedSceneId\n      }\n      this.state.script.addNewMessage(msgData)\n\n      let updatedLikedByMap = new Map(this.state.likedByMap);\n      updatedLikedByMap.set(`${messageId}${this.state.selectedCastId}`, true);\n\n      this.setState({\n        likedByMap: updatedLikedByMap,\n        allMessages: this.state.script.getOnlyTextMsgsAsNodes(),\n        spslm: 0,\n      })\n    }else{\n      this.deleteLikedMessage(messageId, this.state.selectedCastId)\n    }\n  }\n\n  addNewMessage = () => {\n    var milliseconds = Math.floor(Date.now() / 1000)\n\n    let tslmsg = this.state.timeSinceLastMsg\n    if(tslmsg == \"\" || tslmsg == 0){\n      tslmsg = this.state.spslm\n    }\n\n    let msgData = {\n      id: milliseconds,\n      timeStamp: milliseconds,\n      content: this.state.textMsg,\n      senderId: this.state.selectedCastId,\n      tslmsg: tslmsg,\n      msgType: \"textMsg\",\n      sceneId: this.state.selectedSceneId\n    }\n\n    this.state.script.addNewMessage(msgData)\n    this.setState({\n      allMessages: this.state.script.getOnlyTextMsgsAsNodes(),\n      textMsg: \"\",\n      spslm: 0,\n    })\n  }\n\n  addNewMsgComment = (comment, idOfMsgCommented, whoSentCommentedMsg) => {\n    var milliseconds = Math.floor(Date.now() / 1000)\n\n    let tslmsg = this.state.timeSinceLastMsg\n    if(tslmsg == \"\" || tslmsg == 0){\n      tslmsg = this.state.spslm\n    }\n\n    let msgData = {\n      id: milliseconds,\n      timeStamp: milliseconds,\n      msgType: \"comment\",\n      content: comment,\n      whoSentCommentedMsg: whoSentCommentedMsg,\n      idOfMsgCommented: idOfMsgCommented,\n      whoCommentedMsg: this.state.selectedCastId,\n      tslmsg: tslmsg,\n      sceneId: this.state.selectedSceneId\n    }\n\n    this.state.script.addNewMessage(msgData)\n    this.setState({\n      allMessages: this.state.script.getOnlyTextMsgsAsNodes(),\n      textMsg: \"\",\n      spslm: 0,\n    })\n  }\n\n  addNewMediaMsg = (mediaType, mediaURL, isImg, isAudio, isVideo) => {\n\n    var milliseconds = Math.floor(Date.now() / 1000)\n\n    let tslmsg = this.state.timeSinceLastMsg\n    if(tslmsg == \"\" || tslmsg == 0){\n      tslmsg = this.state.spslm\n    }\n\n    let msgData = {\n      id: milliseconds,\n      timeStamp: milliseconds,\n      content: mediaType,\n      senderId: this.state.selectedCastId,\n      tslmsg: tslmsg,\n      isImg: isImg,\n      isAudio: isAudio,\n      isVideo: isVideo,\n      msgType: \"textMsg\",\n      url: mediaURL,\n      sceneId: this.state.selectedSceneId\n    }\n\n    this.state.script.addNewMessage(msgData)\n    this.setState({\n      allMessages: this.state.script.getOnlyTextMsgsAsNodes(),\n      textMsg: \"\",\n      spslm: 0,\n    })\n  }\n\n  componentDidUpdate(){\n    if(this.state.script){\n      this.state.script.updateScriptFirebase()\n    }\n  }\n\n  getInputTime = (timeInSeconds) => {\n    this.setState({\n      timeSinceLastMsg: timeInSeconds,\n    })\n  }\n\n  deleteMessage = (id) => {\n    this.state.script.deleteMessage(id)\n    this.setState({allMessages: this.state.script.getOnlyTextMsgsAsNodes()},\n    () => {\n        this.state.script.updateScriptFirebase()\n    });\n  }\n\n  onSaveComment = (message, idOfMsgCommented, whoSentCommentedMsg) => {\n    let existingCommentNode = this.state.script.getCommentNodeByCastIdMsgId(this.state.selectedCastId, idOfMsgCommented)\n    if(existingCommentNode != nil){\n      this.state.script.editNodeContent(existingCommentNode.id, message)\n    }else{\n      this.addNewMsgComment(message, idOfMsgCommented, whoSentCommentedMsg)\n    }\n  }\n\n  grabScreenshot = (url) => {\n    const element = document.getElementById('EditScript-chatArea-id');\n\n    html2canvas(element).then(canvas => {\n      const imageData = canvas.toDataURL();\n      const milliseconds = Math.floor(Date.now() / 1000)\n      const storageRef = Firebase.storage().ref(\"ScreenShot/\" + milliseconds);\n      storageRef.putString(imageData, 'data_url').then(snapshot => {\n        snapshot.ref.getDownloadURL().then(downloadURL => {\n          console.log(`Image URL: ${downloadURL}`);\n          this.addNewMediaMsg(\"ScreenShot\", downloadURL, true, false, false)\n        });\n      });\n    });\n  }\n\n  getInsertedImg = (url) => {\n    console.log(\"url\", url)\n    this.addNewMediaMsg(\"InsertImage\", url, true, false, false)\n  }\n\n  getUplodedVideo = (url) => {\n    console.log(\"url\", url)\n    this.addNewMediaMsg(\"UploadedVideo\", url, false, false, true)\n  }\n\n  getVNURL = (url) => {\n    console.log(\"url\", url)\n    this.addNewMediaMsg(\"VoiceNote\", url, false, true, false)\n  }\n\n  render() {\n    if(this.state.script){\n        return (\n            <div className=\"EditScript\">\n                <div className=\"EditScript-container l-container\">\n                    <div className=\"EditScript-title\">\n                      <EditableField\n                        name={this.state.script.getScriptName()}\n                        getScriptName={this.getScriptName}\n                      />\n                    </div>\n                    <div className=\"EditScript-scenes\">\n                      <Scenes\n                        scenes = {this.state.script.getAllScenes()}\n                        selectedScene={this.getSelectedScene}\n                        getAllScenes={this.getAllScenes}\n                      />\n                    </div>\n                    <div className=\"EditScript-cast\">\n                      <CastMembers\n                        cast = {this.state.script.getAllCast()}\n                        selectedCast={this.getSelectedCast}\n                        getAllCast={this.getAllCast}\n                      />\n                    </div>\n                    <div className=\"EditScript-textView\">\n                      <MsgTypes\n                        grabScreenshot = {this.grabScreenshot}\n                        getInsertedImg = {this.getInsertedImg}\n                        selectedMsgType = {this.getSelectedMsgType}\n                        getUplodedVideo = {this.getUplodedVideo}\n                        getVNURL = {this.getVNURL}\n                      />\n                      <div id=\"EditScript-chatArea-id\" className=\"EditScript-chatArea\">\n                        {this.state.allMessages.length == 0 &&\n                          <span className=\"EditScript-castMemberPrompt\">click on a cast member to see messages</span>\n                        }\n                        {this.state.allMessages.map((value, index) => (\n                          (value.sceneId == this.state.selectedSceneId)\n                          &&\n                          <DynamicClassAssignment key={index} isActive={value.senderId == this.state.selectedCastId} value={value} index={index} >\n                            {value.isImg &&\n                              <img\n                                className=\"EditScript-imgMsg\"\n                                src={value.url}\n                              />\n                            }\n                            {value.isAudio &&\n                              <audio\n                                className=\"EditScrip-audioMsg\"\n                                src={value.url}\n                                controls\n                              />\n                            }\n                            {value.isVideo &&\n                              <video\n                                className=\"EditScript-videoMsg\"\n                                src={value.url}\n                                controls\n                              />\n                            }\n                            <div>\n                              <span>{value.content}</span>\n                              <span className=\"EditScript-senderName\">{this.state.script.getSenderNameFromID(value.senderId)}</span>\n                            </div>\n                            <div className=\"EditScript-chatArea-msg-buttons\">\n                              <button className=\"EditScript-chatArea-msg-button\" onClick={() => this.deleteMessage(value.id)}>Delete</button>\n                              <button className=\"EditScript-chatArea-msg-button\" onClick={() => this.addNewLikeMsg(value.id, value.senderId)}>{this.alreadyBeenLikedByselectedCastId(value.id) ? \"Unlike\" : \"Like\"}</button>\n                              <CommentedPopup\n                                className=\"EditScript-chatArea-msg-button\"\n                                idOfMsgCommented={value.id}\n                                whoSentCommentedMsg={value.senderId}\n                                onSave={this.onSaveComment}\n                                alreadySavedValue={this.state.script.getCommentByCastIdMsgId(this.state.selectedCastId, value.id)}\n                              />\n                            </div>\n                          </DynamicClassAssignment>\n                        ))}\n                      </div>\n\n                      <div className=\"EditScript-sendMessage\">\n                        <TextField\n                          variant=\"outlined\"\n                          className=\"EditScript-sendMessage--input\"\n                          value={this.state.textMsg}\n                          placeholder=\"Type message here\"\n                          onChange={e => {\n                            this.setState({ textMsg: e.target.value });\n                          }}\n                        />\n                        <TimeInput inputTime={this.getInputTime} />\n                      </div>\n\n                      <div className=\"EditScript-saveSubmit\">\n                        <div>\n                          <Button\n                            className=\"EditScript-saveSubmit--save\"\n                            variant=\"outlined\"\n                            color=\"primary\"\n                            onClick={() => this.state.script.updateScriptFirebase()}\n                          >\n                            save\n                          </Button>\n                        </div>\n                        <div>\n                          <Button\n                            className=\"EditScript-saveSubmit--send\"\n                            variant=\"outlined\"\n                            color=\"primary\"\n                            onClick={() => this.addNewMessage()}\n                          >\n                            Send\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }else{\n        return (\n            <div>script loading...</div>\n        )\n    }\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {};\n};\n\nlet EditScript = withRouter(connect(mapStateToProps)(ConnectedEditScript));\nexport default withRouter(EditScript);\n\n\nconst DynamicClassAssignment = (props) =>{\n\n    if(props.isActive){\n        return (\n            <div className={\"EditScript-chatArea-msg active\"}>\n                {props.children}\n            </div>\n        );\n    }else{\n        return (\n            <div className={\"EditScript-chatArea-msg\"}>\n                {props.children}\n            </div>\n        );\n    }\n  }"],"mappings":"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"},"metadata":{},"sourceType":"module"}